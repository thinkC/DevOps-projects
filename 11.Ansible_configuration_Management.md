

## Step 1 - Install and Configure Ansible on EC2 Instance

We currently have the below setup
![servers](./img-lb-nginx/img-serverlist.png)

1. First we update the Name tag for our Jenkins server to be Jenkins-Ansible . This will be used to run playbooks.
2. We create a new repo named `ansible-config-mgt`
![github](./img-ansible/img2.png)

<code>Note</code>: In other not to be changing our `Jenkins-Ansible` instance IP everytime we reboot or stop the install since the IP address will change as a result, we will configure our instance to use an [Elastic IP](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html).
## Creating Elastic IP
1. Click on Elastic IP
2. Click on Allocate Elastic IP
3. Click Allocate . This then creates a static IP Address
4. Select the Elastic IP address that is allocated, click action and choose Associate Elastic IP
5. Next choose the EC2 instance you want to associate the Elastic IP with

![elastic IP](./img-ansible/img3.png)
6. Click Associate.

![elastic IP](./img-ansible/img4.png)

![elastic IP](./img-ansible/img5.png)

3. Install Ansible

```bash
sudo apt update
sudo apt install ansible
```
We check version of ansible installed.

`ansible --version`

output

```bash
ubuntu@ip-172-31-62-121:~$ ansible --version
ansible 2.9.6
  config file = /etc/ansible/ansible.cfg
  configured module search path = ['/home/ubuntu/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python3/dist-packages/ansible
  executable location = /usr/bin/ansible
  pytho
  n version = 3.8.10 (default, Jun  2 2021, 10:49:15) [GCC 9.4.0]
```
4. Next, we configure our Jenkins build job to save our repository content every time will make changes to our repo.
Next we do the following:
- we create a freestyle project named `ansible` and point it to our `ansible-config-mgt` repo.
![Ansible-freestyle](./img-ansible/img6.png)
- Configure ad set Webhook on GitHub to trigger ansible build. Notice we are using the Public Elastic IP.
![Ansible-freestyle](./img-ansible/img7.png)

- Configure Post-Build Job to save all files.

Add Git repo link under Source Code Management

![Ansible-freestyle](./img-ansible/img8.png)

Choose GitHub Hook Trigger
![Ansible-freestyle](./img-ansible/img9.png)

Type `**` to archive all files and save.
![Ansible-freestyle](./img-ansible/img10.png)

- Next test setup by making changes on the ReadME.md file main Branch of the repository. If the setup is correct, the build should start automatically and Jenkins should save the files (build artifacts) in the folder path below.

`ls /var/lib/jenkins/jobs/ansible/builds/<build_number>/archive/`.

`Note:` When I first made changes to my README.md file on the main branch, the build did not start automatically, when I did a manual build I got error below:

![Ansible-freestyle](./img-ansible/img12.png).

On checking the internet, I found that since Jenkins new job configuration --> Source Code Management --> Git --> Branches to build -->
it is default to "/master" , this should be changed to "/main" since GitHub no longer use "master" as a branch name. Once this was updated build was automatically started after a change was initialed on teh main branch and was successful.

![Ansible-freestyle](./img-ansible/img11.png)

![Ansible-freestyle](./img-ansible/img13.png)


README.md content on GitHub
![Ansible-freestyle](./img-ansible/img14.png)

README.md content on Jenkins
![Ansible-freestyle](./img-ansible/img15.png)