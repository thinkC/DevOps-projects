
# Anisble Refactoring & Static Assignments (Imports and Roles)

## Step 1 - Jenkins job enhancement

We will improve on Jenkins setup by creating another folder which will store all our artifacts, ther reason for this is because before now each time we make any new change in the code , it creates a seperate directory which will eventually consume space on the Jenkins server. We will use `Copy Artifact` plugin to achieve this.

1. On `Jenkins-Ansible` server, we create a directory named `ansible-config-artifact`. This will store all the artifacts after each build.

```bash
mkdir /home/ubuntu/ansible-config-artifact
```
Next we change permission on this directory so that Jenkins can save files in it.

```bash
chmod -R 0777 /home/ubuntu/ansible-config-artifact
```
2. Next we install the `Copy Artifact` plugin. On Jenkins web console -> Manage Jenkins -> Manage Plugin -> Click Available Tab and search for `Copy Artifact`. Click install plugin without restarting Jenkins.

![ansible](./img-ansible/img32-p12.png)

![ansible](./img-ansible/img33-p12.png)

3. Create a new freestyle project and name it `save_artifacts`.

![ansible](./img-ansible/img34-p12.png)

Here we are keeping 2 of our build to conserve space . Number of build to keep can also be changed on the ansible job.

![ansible](./img-ansible/img35-p12.png)

Choose none under source code management

![ansible](./img-ansible/img36-p12.png)

![ansible](./img-ansible/img37-p12.png)

The `save_artifacts` project is to save artifacts into `/home/ubuntu/ansible-config-artifact`

Click on the Build Tab under Build choose `Copy artifacts from other project`

![ansible](./img-ansible/img38-p12.png)

![ansible](./img-ansible/img39-p12.png)

Testing our setup, we will make some change on the README.md file on the main branch inside `ansible-config-mgt` repository on GutHub . 

![ansible](./img-ansible/img40-p12.png)

Both Jenkins Jobs below, completed after the other
![ansible](./img-ansible/img42-p12.png)

![ansible](./img-ansible/img41-p12.png)

Now we see all our folders and files in `ansible-config-artifact` directory.

![ansible](./img-ansible/img43-p12.png)

## Step 2 - Refactor Ansible code by importing other playboos into `site.yml`

<!-- Add Notes here -->

### Importing other playbooks
