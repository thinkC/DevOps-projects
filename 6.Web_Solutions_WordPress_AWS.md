# Implementing Web Solutions with Wordpress on AWS

This project involves creating storage infrastructures on two Linux servers and implementing web solutions using [Wordpress](https://en.wikipedia.org/wiki/WordPress) . Wordpress is a free and open-source content management system written in PHP and paired with MySQL or MariaDB as its backend Relational Database Management System (RDBMS).

Our setup will include:
1. A PC that servers as client
2. A Linux server where we will install wordpress
3. A Linux server that will serve as a database

Note our Linux servers will be hosted on Amaon AWS EC2.

We start by creating an _EC2_ server on AWS and name it _Web Server_.

add steps to create EC2 here...

Next, we create 3 volumes and add to our _Web Server_.

Click on Volume on _Elastic Block Store_.
![EBS](https://github.com/thinkC/devops-projects/blob/master/img-web-wordpress/img8.PNG?raw=true)

Click create volume, change size to 10GB, and choose availability zone that is same location with the server . We will repeat this step of creating volumes two more times to create 3 volumes.

![EBS](https://github.com/thinkC/devops-projects/blob/master/img-web-wordpress/img8a.PNG?raw=true)

Choose the new VM _Web Server_ and click attach
![EBS](https://github.com/thinkC/devops-projects/blob/master/img-web-wordpress/img8b.PNG?raw=true)
![EBS](https://github.com/thinkC/devops-projects/blob/master/img-web-wordpress/img9.PNG?raw=true)

Next connect to the VM server _web server_ with ssh

```bash
ssh -i C:\Users\user1\Desktop\Downloads\mysingular-EC2.pem ec2-user@52.23.233.125
```
List all blcok to see if it is listed.

```bash
lsblk
```
output

```bash
NAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
xvda    202:0    0   8G  0 disk
└─xvda1 202:1    0   8G  0 part /
xvdf    202:80   0  10G  0 disk
xvdg    202:96   0  10G  0 disk
xvdh    202:112  0  10G  0 disk
```
They are listed as _xvdf_, _xvdg_, _xvdh_ .

Next, we run `df -h` to see all the mounts and free space on the web server

 output
```bash
Filesystem      Size  Used Avail Use% Mounted on
devtmpfs        482M     0  482M   0% /dev
tmpfs           492M     0  492M   0% /dev/shm
tmpfs           492M  476K  492M   1% /run
tmpfs           492M     0  492M   0% /sys/fs/cgroup
/dev/xvda1      8.0G  1.5G  6.6G  18% /
tmpfs            99M     0   99M   0% /run/user/1000
tmpfs            99M     0   99M   0% /run/user/0
```
Next, we create a single partition on each of the 3 disks.

```bash
sudo gdisk /dev/xvdf
sudo gdisk /dev/xvdg
sudo gdisk /dev/xvdh
```

output

```bash
GPT fdisk (gdisk) version 0.8.10

Partition table scan:
  MBR: not present
  BSD: not present
  APM: not present
  GPT: not present

Creating new GPT entries.

Command (? for help): 
```
Typing '?' shows the menus. Her

```bash
Command (? for help): ?
b       back up GPT data to a file
c       change a partition's name
d       delete a partition
i       show detailed information on a partition
l       list known partition types
n       add a new partition
o       create a new empty GUID partition table (GPT)
p       print the partition table
q       quit without saving changes
r       recovery and transformation options (experts only)
s       sort partitions
t       change a partition's type code
v       verify disk
w       write table to disk and exit
x       extra functionality (experts only)
?       print this menu

Command (? for help): 
```

We choose 'n' to create new Partition.

output

```bash
Command (? for help): n
Partition number (1-128, default 1):
First sector (34-20971486, default = 2048) or {+-}size{KMGTP}:
Last sector (2048-20971486, default = 20971486) or {+-}size{KMGTP}:
Current type is 'Linux filesystem'
```

Type 'l'small 'l' or big 'L' to show codes

output
```bash
Hex code or GUID (L to show codes, Enter = 8300): l
0700 Microsoft basic data  0c01 Microsoft reserved    2700 Windows RE
3000 ONIE boot             3001 ONIE config           4100 PowerPC PReP boot
4200 Windows LDM data      4201 Windows LDM metadata  7501 IBM GPFS
7f00 ChromeOS kernel       7f01 ChromeOS root         7f02 ChromeOS reserved
8200 Linux swap            8300 Linux filesystem      8301 Linux reserved
8302 Linux /home           8400 Intel Rapid Start     8e00 Linux LVM
a500 FreeBSD disklabel     a501 FreeBSD boot          a502 FreeBSD swap
a503 FreeBSD UFS           a504 FreeBSD ZFS           a505 FreeBSD Vinum/RAID
a580 Midnight BSD data     a581 Midnight BSD boot     a582 Midnight BSD swap
a583 Midnight BSD UFS      a584 Midnight BSD ZFS      a585 Midnight BSD Vinum
a800 Apple UFS             a901 NetBSD swap           a902 NetBSD FFS
a903 NetBSD LFS            a904 NetBSD concatenated   a905 NetBSD encrypted
a906 NetBSD RAID           ab00 Apple boot            af00 Apple HFS/HFS+
af01 Apple RAID            af02 Apple RAID offline    af03 Apple label
af04 AppleTV recovery      af05 Apple Core Storage    be00 Solaris boot
bf00 Solaris root          bf01 Solaris /usr & Mac Z  bf02 Solaris swap
bf03 Solaris backup        bf04 Solaris /var          bf05 Solaris /home
bf06 Solaris alternate se  bf07 Solaris Reserved 1    bf08 Solaris Reserved 2
bf09 Solaris Reserved 3    bf0a Solaris Reserved 4    bf0b Solaris Reserved 5
c001 HP-UX data            c002 HP-UX service         ea00 Freedesktop $BOOT
eb00 Haiku BFS             ed00 Sony system partitio  ed01 Lenovo system partit
Press the <Enter> key to see more codes:
ef00 EFI System            ef01 MBR partition scheme  ef02 BIOS boot partition
fb00 VMWare VMFS           fb01 VMWare reserved       fc00 VMWare kcore crash p
fd00 Linux RAID           
```
Type _8e00_ to choose Linux LVM

```bash
Hex code or GUID (L to show codes, Enter = 8300): 8e00
Changed type of partition to 'Linux LVM'

Command (? for help): p
Disk /dev/xvdf: 20971520 sectors, 10.0 GiB
Logical sector size: 512 bytes
Disk identifier (GUID): A7345FC4-B5D7-45FE-B76E-55FCFE1BDB26
Partition table holds up to 128 entries
First usable sector is 34, last usable sector is 20971486
Partitions will be aligned on 2048-sector boundaries
Total free space is 2014 sectors (1007.0 KiB)

Number  Start (sector)    End (sector)  Size       Code  Name
   1            2048        20971486   10.0 GiB    8E00  Linux LVM

Command (? for help): 
```
Type 'w' to write and 'Y' tp proceed.

```bash
Command (? for help): w

Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING
PARTITIONS!!

Do you want to proceed? (Y/N): Y
OK; writing new GUID partition table (GPT) to /dev/xvdf.
The operation has completed successfully.
```

Do the same procedure for other two disks

Run command below to view the newly configured partition on each of the 3 disks

```bash
lsblk
```

output

```bash
NAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
xvda    202:0    0   8G  0 disk
└─xvda1 202:1    0   8G  0 part /
xvdf    202:80   0  10G  0 disk
└─xvdf1 202:81   0  10G  0 part
xvdg    202:96   0  10G  0 disk
└─xvdg1 202:97   0  10G  0 part
xvdh    202:112  0  10G  0 disk
└─xvdh1 202:113  0  10G  0 part
```

Next we install `lvm2` to check available partitions.

```bash 
sudo yum install lvm2
```

Next, we do the following to create a _Logical Volume_

1. Run _pvcreate_ utility to mark each 3 disks as a physical volume (PVs)

```bash
sudo pvcreate /dev/xvdf1
sudo pvcreate /dev/xvdg1
sudo pvcreate /dev/xvdh1
```

output

```bash
[ec2-user@ip-172-31-88-7 ~]$ sudo pvcreate /dev/xvdf1
  Physical volume "/dev/xvdf1" successfully created.
[ec2-user@ip-172-31-88-7 ~]$ sudo pvcreate /dev/xvdg1
  Physical volume "/dev/xvdg1" successfully created.
[ec2-user@ip-172-31-88-7 ~]$ sudo pvcreate /dev/xvdh1
  Physical volume "/dev/xvdh1" successfully created.
```

2. Verify our Physical volume is created

```bash
sudo pvs
```

output

```bash
/dev/sdf1     lvm2 ---  <10.00g <10.00g
/dev/sdg1     lvm2 ---  <10.00g <10.00g
/dev/sdh1     lvm2 ---  <10.00g <10.00g
```

3. Use `vgcreate` utility to add all 3 Physocal Volumes to a Volume group (VG) , name the VG as _webdata-vg_ .

```bash
sudo vgcreate webdata-vg /dev/xvdh1 /dev/xvdg1 /dev/xvdf1
```

output

```bash
Volume group "webdata-vg" successfully created
```

Verify the Volume Group is created.

```bash
sudo vgs
```

output

```bash
VG         #PV #LV #SN Attr   VSize   VFree
webdata-vg   3   0   0 wz--n- <29.99g <29.99g
```

4. Use `lvcreate` utility to create 2 logical volumes named `apps-lv` . We use half of the PV size and `logs-lv` to use the remaining space

```bash
sudo lvcreate -n apps-lv -L 14G webdata-vg
sudo lvcreate -n logs-lv -L 14G webdata-vg
```

output

```bash
[ec2-user@ip-172-31-88-7 ~]$ sudo lvcreate -n apps-lv -L 14G webdata-vg
  Logical volume "apps-lv" created.
[ec2-user@ip-172-31-88-7 ~]$ sudo lvcreate -n logs-lv -L 14G webdata-vg
  Logical volume "logs-lv" created.
[ec2-user@ip-172-31-88-7 ~]$
```

We, verify that our Logical Volume is created successfully.

```bash
sudo lvs
```

output

```bash
LV      VG         Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  apps-lv webdata-vg -wi-a----- 14.00g
  logs-lv webdata-vg -wi-a----- 14.00g
```

5. Verify the entire setup

```bash
sudo vgdisplay -v
```

output

```bash
--- Volume group ---
  VG Name               webdata-vg
  System ID
  Format                lvm2
  Metadata Areas        3
  Metadata Sequence No  3
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                2
  Open LV               0
  Max PV                0
  Cur PV                3
  Act PV                3
  VG Size               <29.99 GiB
  PE Size               4.00 MiB
  Total PE              7677
  Alloc PE / Size       7168 / 28.00 GiB
  Free  PE / Size       509 / <1.99 GiB
  VG UUID               B5B8Yf-ufYu-2kdv-555Q-v7SZ-ChV9-YJUGsm

  --- Logical volume ---
  LV Path                /dev/webdata-vg/apps-lv
  LV Name                apps-lv
  VG Name                webdata-vg
  LV UUID                MHtfOl-LeOU-vpf5-DoJM-OADF-tnWS-egS2Mq
  LV Write Access        read/write
  LV Creation host, time ip-172-31-88-7.ec2.internal, 2021-07-02 19:51:00 +0000
  LV Status              available
  # open                 0
  LV Size                14.00 GiB
  Current LE             3584
  Segments               2
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:0

  --- Logical volume ---
  LV Path                /dev/webdata-vg/logs-lv
  LV Name                logs-lv
  VG Name                webdata-vg
  LV UUID                L9aZda-6RVx-CtPj-BnJw-TnvT-kkTO-HsUq0Y
  LV Write Access        read/write
  LV Creation host, time ip-172-31-88-7.ec2.internal, 2021-07-02 19:51:21 +0000
  LV Status              available
  # open                 0
  LV Size                14.00 GiB
  Current LE             3584
  Segments               2
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:1

  --- Physical volumes ---
  PV Name               /dev/sdh1
  PV UUID               qSw7vo-AwpW-auyU-cIoN-Qyo0-DZ9B-952AOB
  PV Status             allocatable
  Total PE / Free PE    2559 / 0

  PV Name               /dev/sdg1
  PV UUID               14ejDf-PqM6-1hvQ-Za2n-ZFBx-R0Wd-MlREtR
  PV Status             allocatable
  Total PE / Free PE    2559 / 509

  PV Name               /dev/sdf1
  PV UUID               AO6HPt-ADw2-PR2C-vUlb-mf7C-NXhw-gD7G9M
  PV Status             allocatable
  Total PE / Free PE    2559 / 0
  ```

  ```bash
  sudo lsblk 
  ```

  output

```bash
NAME                     MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
xvda                     202:0    0   8G  0 disk
└─xvda1                  202:1    0   8G  0 part /
xvdf                     202:80   0  10G  0 disk
└─xvdf1                  202:81   0  10G  0 part
  └─webdata--vg-logs--lv 253:1    0  14G  0 lvm
xvdg                     202:96   0  10G  0 disk
└─xvdg1                  202:97   0  10G  0 part
  ├─webdata--vg-apps--lv 253:0    0  14G  0 lvm
  └─webdata--vg-logs--lv 253:1    0  14G  0 lvm
xvdh                     202:112  0  10G  0 disk
└─xvdh1                  202:113  0  10G  0 part
  └─webdata--vg-apps--lv 253:0    0  14G  0 lvm
```

6. Format the logical volumes with _ext4_ filesystem .

```bash
sudo mkfs -t ext4 /dev/webdata-vg/apps-lv
sudo mkfs -t ext4 /dev/webdata-vg/logs-lv
```


output for webdata-vg/apps-lv

```bash
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
917504 inodes, 3670016 blocks
183500 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2151677952
112 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208

Allocating group tables: done
Writing inode tables: done
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done
```

output for webdata-vg/logs-lv

```bash
mke2fs 1.42.9 (28-Dec-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
917504 inodes, 3670016 blocks
183500 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=2151677952
112 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks:
        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208

Allocating group tables: done
Writing inode tables: done
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done
```

7. Create directory /var/www/html to store website files.

```bash
sudo mkdir -p /var/www/html
```

8. Create /home/recovery/logs to syore backup of log data

```bash
sudo mkdir -p /home/recovery/logs
```
9. Create a mount point /var/www/html to mount apps-lv logical volume .

```bash
sudo mount /dev/webdata-vg/apps-lv /var/www/html/
```

Check if logical volume is mounted

```bash
df -hT
```

output
Filesystem                       Type      Size  Used Avail Use% Mounted on
devtmpfs                         devtmpfs  482M     0  482M   0% /dev
tmpfs                            tmpfs     492M     0  492M   0% /dev/shm
tmpfs                            tmpfs     492M  472K  492M   1% /run
tmpfs                            tmpfs     492M     0  492M   0% /sys/fs/cgroup
/dev/xvda1                       xfs       8.0G  1.5G  6.6G  18% /
tmpfs                            tmpfs      99M     0   99M   0% /run/user/1000
/dev/mapper/webdata--vg-apps--lv ext4       14G   41M   13G   1% /var/www/html
```

10. Use _rsync_ utility to backup all files in the log directory /var/log into /home.recovery/logs (This is required before counting the filesystem)

```bash
sudo rsync -av /var/log/. /home/recovery/logs/
```

output
```bash
sending incremental file list
./
boot.log
btmp
cloud-init-output.log
cloud-init.log
cron
dmesg
grubby_prune_debug
lastlog
maillog
messages
secure
spooler
tallylog
wtmp
yum.log
amazon/
amazon/ssm/
amazon/ssm/amazon-ssm-agent.log
amazon/ssm/hibernate.log
amazon/ssm/audits/
amazon/ssm/audits/amazon-ssm-agent-audit-2021-07-02
audit/
audit/audit.log
chrony/
journal/
journal/ec241e799eaf2c0ee222f87da91ab53c/
journal/ec241e799eaf2c0ee222f87da91ab53c/system.journal
sa/
sa/sa02

sent 9,248,884 bytes  received 466 bytes  18,498,700.00 bytes/sec
total size is 9,244,828  speedup is 1.00
```

10. Mount /var/log on logs-lv i.e. Make /var/log a mount point and mount logs-lv logical volume.

```bash
sudo mount /dev/webdata-vg/logs-lv /var/log
```
Checking if mount is successful.

```bash
df -hT
```

output

```bash
Filesystem                       Type      Size  Used Avail Use% Mounted on
devtmpfs                         devtmpfs  482M     0  482M   0% /dev
tmpfs                            tmpfs     492M     0  492M   0% /dev/shm
tmpfs                            tmpfs     492M  472K  492M   1% /run
tmpfs                            tmpfs     492M     0  492M   0% /sys/fs/cgroup
/dev/xvda1                       xfs       8.0G  1.5G  6.6G  19% /
tmpfs                            tmpfs      99M     0   99M   0% /run/user/1000
/dev/mapper/webdata--vg-apps--lv ext4       14G   41M   13G   1% /var/www/html
/dev/mapper/webdata--vg-logs--lv ext4       14G   41M   13G   1% /var/log
```

11. Restore log file back into /var/log directory

```bash
sudo rsync -av /home/recovery/logs/log/. /var/log
```

12. Edit _/etc/fstab_ so that mount configuration will persist after reboot of the server. We will use the _UUID_ of the device to update _/etc/fstab_ .

Use _sudo blkid_ to get the UUID .

output
```bash
/dev/xvda1: LABEL="/" UUID="8562e9fb-f45b-4a09-9778-bde97be4afb3" TYPE="xfs" PARTLABEL="Linux" PARTUUID="5e8ed354-3406-4942-9b72-a557417e17d6"
/dev/xvdf1: UUID="AO6HPt-ADw2-PR2C-vUlb-mf7C-NXhw-gD7G9M" TYPE="LVM2_member" PARTLABEL="Linux LVM" PARTUUID="586afa65-010e-4936-bb89-9f8f1b59fa79"
/dev/xvdg1: UUID="14ejDf-PqM6-1hvQ-Za2n-ZFBx-R0Wd-MlREtR" TYPE="LVM2_member" PARTLABEL="Linux LVM" PARTUUID="dbb1cbbe-7201-43d7-b3b6-5a4535383086"
/dev/xvdh1: UUID="qSw7vo-AwpW-auyU-cIoN-Qyo0-DZ9B-952AOB" TYPE="LVM2_member" PARTLABEL="Linux LVM" PARTUUID="d6d8e1df-da04-476c-88da-1ed3dda1809d"
/dev/mapper/webdata--vg-apps--lv: UUID="34096a97-de0a-48bf-b6c9-1f9879dac4b2" TYPE="ext4"
/dev/mapper/webdata--vg-logs--lv: UUID="35f95ab8-634a-44d3-a829-cb56e156bf7e" TYPE="ext4"
```

```bash
sudo nano /etc/fstab/
```

![fstab](https://github.com/thinkC/devops-projects/blob/master/img-web-wordpress/img10.PNG?raw=true)

13. Test configuration and reload daemon

```bash 
sudo mount -a
sudo systemctl daemon-reload
```

14. Check if logical volumes are still mounted

```bash
df -hT
```

output

```bash
[ec2-user@ip-172-31-88-7 ~]$ df -hT
Filesystem                       Type      Size  Used Avail Use% Mounted on
devtmpfs                         devtmpfs  482M     0  482M   0% /dev
tmpfs                            tmpfs     492M     0  492M   0% /dev/shm
tmpfs                            tmpfs     492M  488K  492M   1% /run
tmpfs                            tmpfs     492M     0  492M   0% /sys/fs/cgroup
/dev/xvda1                       xfs       8.0G  1.5G  6.6G  19% /
tmpfs                            tmpfs      99M     0   99M   0% /run/user/1000
/dev/mapper/webdata--vg-apps--lv ext4       14G   41M   13G   1% /var/www/html
/dev/mapper/webdata--vg-logs--lv ext4       14G   41M   13G   1% /var/log
```

## Prepare Database server

We launch another EC2 servr named _DB Server_. We repeat the same steps like we did for the web server but instead of _apps-lv_ logical volume we name it as _db-lv_ logical volume and mount it to _/db_ directory instead of _/var/www/html_.
